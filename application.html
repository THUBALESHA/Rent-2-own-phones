<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thubalesha Trading | Application</title>
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#000;color:#fff;}
header{background:linear-gradient(135deg,#000,#111);padding:40px 20px;text-align:center;border-bottom:2px solid gold;}
header h1{color:gold;font-size:32px;}
.section{padding:40px 20px;max-width:600px;margin:auto;}
label{font-weight:bold;color:gold;}
input, select, textarea, button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none;font-size:16px;}
button{cursor:pointer;}
.submit-btn{background:gold;color:#000;font-weight:bold;}
a.back{display:block;color:gold;margin:15px 0;text-decoration:none;text-align:center;}
#yoco-button button{width:100%;padding:12px;font-size:16px;border:none;border-radius:8px;background:gold;color:#000;margin-top:10px;}
</style>
</head>
<body>

<header>
<h1>Thubalesha Trading Application</h1>
<p>Fill in your details below to apply for a rent-to-own phone</p>
</header>

<section class="section">
<form id="appForm">
<label>Full Name</label>
<input type="text" id="name" placeholder="Full Name" required>

<label>ID Number</label>
<input type="text" id="id" placeholder="South African ID Number" required>

<label>Phone Number</label>
<input type="tel" id="phone" placeholder="Your Phone Number" required>

<label>Home Address</label>
<textarea id="address" placeholder="Home Address" required></textarea>

<label>Select Phone</label>
<select id="device">
  <option>Honor X6c</option>
  <option>Samsung A05</option>
  <option>Samsung A15</option>
  <option>Redmi 13C</option>
  <option>Nokia C32</option>
</select>

<label>Payment Plan</label>
<select id="payment">
  <option>Weekly Payment</option>
  <option>Monthly Payment</option>
</select>

<label>Employment Status</label>
<input type="text" id="employment" required>

<!-- Hidden Selfie -->
<video id="video" autoplay style="display:none;"></video>
<button type="button" class="submit-btn" onclick="captureSelfie()">Capture Selfie</button>

<label>Upload ID Document</label>
<input type="file" id="idFile" accept="image/*,.pdf" required>

<label>Upload Proof of Address</label>
<input type="file" id="addressFile" accept="image/*,.pdf" required>

<!-- Yoco Pay Button -->
<div id="yoco-button"></div>

<button type="button" class="submit-btn" onclick="sendWhatsApp()">Submit via WhatsApp</button>
<button type="button" class="submit-btn" onclick="sendEmail()">Submit via Email</button>

</form>

<a href="index.html" class="back">‚Üê Back to Home</a>
</section>

<script>
// Hidden selfie capture
const video = document.getElementById('video');
navigator.mediaDevices.getUserMedia({video:true})
.then(stream => video.srcObject = stream)
.catch(err => console.error("Camera denied:", err));

function captureSelfie(){
  if(!video.srcObject) return alert("Camera not available");
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  window.selfieData = canvas.toDataURL('image/png');
  alert("Selfie captured successfully (hidden).");
}

// Convert file to Base64
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.readAsDataURL(file);
    reader.onload=()=>resolve(reader.result);
    reader.onerror=err=>reject(err);
  });
}

// Get form data
function getFormData(){
  return {
    name: document.getElementById("name").value,
    id: document.getElementById("id").value,
    phone: document.getElementById("phone").value,
    address: document.getElementById("address").value,
    device: document.getElementById("device").value,
    payment: document.getElementById("payment").value,
    employment: document.getElementById("employment").value
  };
}

// WhatsApp submit
async function sendWhatsApp(){
  const d = getFormData();
  const idFile = document.getElementById('idFile').files[0];
  const addressFile = document.getElementById('addressFile').files[0];
  let idData = idFile ? await fileToBase64(idFile) : "No file";
  let addressData = addressFile ? await fileToBase64(addressFile) : "No file";

  let msg = `New Application - Thubalesha Trading:%0AName: ${d.name}%0AID: ${d.id}%0APhone: ${d.phone}%0AAddress: ${d.address}%0ADevice: ${d.device}%0APayment: ${d.payment}%0AEmployment: ${d.employment}%0ASelfie captured%0AID: ${idFile ? idFile.name : 'None'}%0AProof of Address: ${addressFile ? addressFile.name : 'None'}`;
  console.log("Selfie Base64:", window.selfieData);
  console.log("ID Base64:", idData);
  console.log("Address Base64:", addressData);
  window.open("https://wa.me/27787102337?text=" + encodeURIComponent(msg), "_blank");
}

// Email submit
async function sendEmail(){
  const d = getFormData();
  const idFile = document.getElementById('idFile').files[0];
  const addressFile = document.getElementById('addressFile').files[0];
  let idData = idFile ? await fileToBase64(idFile) : "No file";
  let addressData = addressFile ? await fileToBase64(addressFile) : "No file";
  const subject = "New Rent-To-Own Application";
  const body = `Name: ${d.name}%0D%0AID: ${d.id}%0D%0APhone: ${d.phone}%0D%0AAddress: ${d.address}%0D%0ADevice: ${d.device}%0D%0APayment: ${d.payment}%0D%0AEmployment: ${d.employment}%0D%0ASelfie captured%0D%0AID: ${idFile ? idFile.name : 'None'}%0D%0AProof of Address: ${addressFile ? addressFile.name : 'None'}`;
  window.location.href = `mailto:thubalesha0001@gmail.com?subject=${subject}&body=${body}`;
}

// Yoco Pay integration
var script = document.createElement('script');
script.src = "https://js.yoco.com/sdk/v1/yoco-sdk-web.js";
script.onload = function(){
  const yoco = new window.YocoSDK({publicKey:'pk_test_YOUR_PUBLIC_KEY'}); // Replace with your public key
  const buttonDiv = document.getElementById('yoco-button');
  const payButton = document.createElement('button');
  payButton.textContent = "Pay Deposit / Installment via Yoco";
  payButton.onclick = function(){
    yoco.showPopup({amountInCents:5000, currency:'ZAR'}) // Example R50
    .then(res=>{
      alert("Payment successful! You can now submit your application.");
    })
    .catch(err=>alert("Payment failed!"));
  };
  buttonDiv.appendChild(payButton);
};
document.head.appendChild(script);
</script>

</body>
</html>